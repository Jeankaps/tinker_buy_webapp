<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinkerBuy E-Commerce: Products</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        body, h1, h2, p, ul, li {
            margin: 0;
            padding: 0
        }

        body {
            font-family: Arial,'Times New Roman';
            line-height: 1.6;
            color: black;
            background-color: floralwhite;
            header,nav,main,footer

        {
            text-align: center;
            padding: 20px;
        }

        header {
            background: #b9fffb;
            color: black;
        }

        nav {
            background: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

            nav ul {
                list-style: none;
                display: flex;
                justify-content: center;
            }

                nav ul li {
                    padding: 10px 20px;
                }

                    nav ul li a {
                        margin: 20px 0;
                    }

        main {
            margin: 20px 0;
        }

        footer {
            background-color: #333;
            color: #fff;
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 10px 0;
        }

        .product-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

            .product-container > div {
                width: 200px;
                margin: 10px;
                padding: 10px;
                background: #fff;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

        .image-container {
            position: relative;
            width: 300px;
        }

        .product-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .image-caption {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 10px;
            box-sizing: border-box;
        }
        .cart-item{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:10px;
            margin: 5px 0;
            background: floralwhite;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .cart-item .item-details{
            display:flex;
            flex-direction:column;
        }
        .cart-item button{
            background-color: #abfaff;
            color:black;
            border:none;
            padding: 5px 10px;
            cursor:pointer;
        }
        .cart-item button:hover{
            background-color: #2daede;
        }
    </style>
</head>


<body>
    <header>
        <h1>Welcome to TinkerBuy: Products</h1>
        <p>Your one-stop shop for all things amazing!</p>
    </header>
    <nav>
        <ul>
            <li><button onclick="location.href='../../../templates/base.html'"><i class="fa fa-home"></i>Home</button></li>
            <li><button onclick="location.href='product_detail.html'"><i class="fa fa-shopping-cart"></i>Products</button></li>

            <li><button onclick="location.href='../../../admin/templates/admin/product_management.html'"><i class="fa fa-key"></i>Admin</button></li>
            <li><a href="#"><i class="fa fa-phone-alt"></i>Contact</a></li>
        </ul>
    </nav>
    <div id="cartItems"></div>
    <form action="/checkout" method="POST">
        <h2>Shipping Information</h2>
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required>
        <br>
        <label for="city">City:</label>
        <input type="text" id="city" name="city" required>
        <br>
        <label for="state">State:</label>
        <input type="text" id="state" name="state" required>
        <br>
        <label for="zip">Zip:</label>
        <input type="text" id="zip" name="zip" required>
        <br>

        <h2>Payment Information</h2>
        <label for="cc-number">Credit Card Number:</label>
        <input type="text" id="cc-number" name="cc_number" required>
        <br>
        <label for="expiry">Expiry Date:</label>
        <input type="text" id="expiry" name="expiry" placeholder="MM/YY" required>
        <br>
        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv" required>
        <br>

        <button type="submit">Checkout</button>


    </form>
    <button onclick="clearCart()">Clear Cart</button>





    <script>
        function processCheckout() {
            const cartItems = JSON.parse(localStorage.getItem('cart')) || {};
            if (Object.keys(cartItems).length === 0) {
                alert('Your cart is empty!');
                return;
            }

            fetch('/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(Object.keys(cartItems).map(key => ({
                    productName: key,
                    quantity: cartItems[key].quantity
                })))
            })//This will send the item to something for flask handling.
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert(data.message);
                        clearCart();
                    } else {
                        alert('There was a problem with your checkout.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            clearCart();//Will need to be commented out once the back end is develped
        }

        function displayCart() {
            const cartItems = JSON.parse(localStorage.getItem('cart')) || {};
            const cartContainer = document.getElementById('cartItems');
            cartContainer.innerHTML = '';

            if (Object.keys(cartItems).length === 0) {
                cartContainer.innerHTML = '<p>Your cart is empty.</p>';
            } else {
                Object.keys(cartItems).forEach(productName => {
                    const item = cartItems[productName];
                    cartContainer.innerHTML += `<div class="cart-item">
                        <div class="item-details">
                            <span>${productName}</span>
                            <span>Price: $${item.price}</span>
                            <span>Quantity: ${item.quantity}</span>
                        </div>
                        <div class="item-actions">
                            <button onclick="addToCart('${productName}', ${item.price})">+</button>
                            <button onclick="removeFromCart('${productName}')">-</button>
                        </div>
                    </div>`;
                });
            }
        }
        displayCart();

        function clearCart() {
            localStorage.removeItem('cart');
            displayCart();
        }

        function addToCart(productName, price) {
            let cart = JSON.parse(localStorage.getItem('cart')) || {};
            if (cart[productName]) {
                cart[productName].quantity += 1;
            } else {
                cart[productName] = { price, quantity: 1 };
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }

        function removeFromCart(productName) {
            let cart = JSON.parse(localStorage.getItem('cart')) || {};
            if (cart[productName] && cart[productName].quantity > 1) {
                cart[productName].quantity -= 1;
            } else {
                delete cart[productName];
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }
        document.addEventListener('DOMContentLoaded', displayCart);
    </script>
</body>
</html>